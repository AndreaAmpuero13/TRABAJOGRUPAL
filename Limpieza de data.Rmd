---
title: "TRABAJO FINAL"
author: "Andrea Ampuero"
date: "2023-10-20"
output: html_document
---

```{r}
setwd("C:/Users/ANDRE/Desktop/trabajo grupal")
```

Abrir data

```{r}
library(rio)
linkdataEelecc="https://github.com/AndreaAmpuero13/TRABAJOGRUPAL/raw/main/ELECCIONES.xlsx"
DataEG2021=import(linkdataEelecc)

```

Revisar estructura de la data
```{r}
str(DataEG2021)
```
 Revisar nombres
```{r}
names(DataEG2021)
```
Quedarme solo con las columnas que necesito(variables a utilizar) todas menos las señaladas

```{r}
library(dplyr)
BSEG2021=DataEG2021[,-c(4,5,6,7,9,10,11,12,14,15)]
```

Ver nombres de las columnas de la nueva base de datos luego de la limpieza de columnas

```{r}
names(BSEG2021)
```
Cambiar nombres de algunas columnas -las que tienen símbolos que pueden generar error [tilde. %]-
```{r}
newNames=c("PorAusen","OP","PorVot")
names(BSEG2021)[c(4,5,6)]=newNames
```

Revisar que se realizaron los cambios
```{r}
names(BSEG2021)
```

queremos quedarnos solo con la info de las 4 organizaciones por distrito

```{r}
library(dplyr)
```

```{r}
BASEFILT=filter(BSEG2021, OP=="ALIANZA PARA EL PROGRESO" | OP=="FUERZA POPULAR" | OP=="PARTIDO POLITICO NACIONAL PERU LIBRE" |  OP=="RESTAURACION NACIONAL")
```


```{r}
library(magrittr)
head(BASEFILT,20)%>%
    rmarkdown::paged_table(options = )
```

quitar una variable de valor la de asusentismo para ver si eso es el error



```{r}
library(dplyr)
BASEFILTMEA=BASEFILT[,-c(4)]
```


HACER EL CAMBIO PARA POSICIONAR LOS POARTIDOS POLÍTICOS COMO ENCABEZADO DE LAS COLUMNAS
```{r}
library(reshape2)
BASEFILTMEA_wide=dcast(data=BASEFILTMEA,
                     formula=Region+Provincia+Distrito ~ OP,
                     value.var="PorVot")
```


esta es la base oficial filtrada(BASEFILT) que luego adapttamos con reshape de long a wide para que las OP queden como encabezados de las columnas más el ausentismo que se miden no por OP sino por distrito 



```{r}
library(reshape2)
Wide_BASEFILT=dcast(data=BASEFILT,
                     formula=Region+Provincia+Distrito+PorAusen ~ OP,
                     value.var="PorVot")
```

creamos variable unificadora en la base de datos de elecciones
```{r}
Wide_BASEFILT$UNIF = paste0(Wide_BASEFILT$Region, Wide_BASEFILT$Provincia, Wide_BASEFILT$Distrito)
Wide_BASEFILT= select(Wide_BASEFILT, c(1:9))
```


```{r}
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AMAZONASLUYASAN FRANCISCO DEL YESO','UNIF']='AMAZONASLUYASAN FRANCISCO DE YESO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AMAZONASRODRIGUEZ DE MENDOZAMILPUCC','UNIF']='AMAZONASRODRIGUEZ DE MENDOZAMILPUC'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHSANTANEPEÑA','UNIF']='ANCASHSANTANEPENA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDILLAMELLIN','UNIF']='ANCASHANTONIO RAYMONDILLAMELLIN'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDIACZO','UNIF']='ANCASHANTONIO RAYMONDIACZO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDICHACCHO','UNIF']='ANCASHANTONIO RAYMONDICHACCHO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDICHINGAS','UNIF']='ANCASHANTONIO RAYMONDICHINGAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDIMIRGAS','UNIF']='ANCASHANTONIO RAYMONDIMIRGAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ANCASHANTONIO RAIMONDISAN JUAN DE RONTOY','UNIF']='ANCASHANTONIO RAYMONDISAN JUAN DE RONTOY'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='APURIMACAYMARAESIHUAYLLO','UNIF']='APURIMACAYMARAESHUAYLLO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='APURIMACAYMARAESSAÑAYCA','UNIF']='APURIMACAYMARAESSANAYCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='APURIMACAYMARAESSAN JUAN DE CHACÑA','UNIF']='APURIMACAYMARAESSAN JUAN DE CHACNA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='APURIMACGRAUMARISCAL GAMARRA','UNIF']='APURIMACGRAUGAMARRA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AREQUIPAAREQUIPAQUEQUEÑA','UNIF']='AREQUIPAAREQUIPAQUEQUENA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AREQUIPAAREQUIPASANTA RITA DE SIHUAS','UNIF']='AREQUIPAAREQUIPASANTA RITA DE SIGUAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AREQUIPACAMANAOCOÑA','UNIF']='AREQUIPACAMANAOCONA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AREQUIPACASTILLAUÑON','UNIF']='AREQUIPACASTILLAUNON'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AYACUCHOLUCANASCHAVIÑA','UNIF']='AYACUCHOLUCANASCHAVINA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AYACUCHOLUCANASOCAÑA','UNIF']='AYACUCHOLUCANASOCANA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AYACUCHOPARINACOCHASCORONEL CASTAÑEDA','UNIF']='AYACUCHOPARINACOCHASCORONEL CASTANEDA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AYACUCHOVICTOR FAJARDOHUALLA','UNIF']='AYACUCHOVICTOR FAJARDOHUAYA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='AYACUCHOSUCREHUACAÑA','UNIF']='AYACUCHOSUCREHUACANA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CAJAMARCACAJAMARCAENCAÑADA','UNIF']='CAJAMARCACAJAMARCAENCANADA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CAJAMARCACAJAMARCALOS BAÑOS DEL INCA','UNIF']='CAJAMARCACAJAMARCALOS BANOS DEL INCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CAJAMARCACONTUMAZASANTA CRUZ DE TOLED','UNIF']='CAJAMARCACONTUMAZASANTA CRUZ DE TOLEDO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CAJAMARCASANTA CRUZCHANCAYBAÑOS','UNIF']='CAJAMARCASANTA CRUZCHANCAYBANOS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CUSCOCHUMBIVILCASQUIÑOTA','UNIF']='CUSCOCHUMBIVILCASQUINOTA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CUSCOPAUCARTAMBOKOSÑIPATA','UNIF']='CUSCOPAUCARTAMBOKOSNIPATA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANCAVELICAANGARAESHUALLAY-GRANDE','UNIF']='HUANCAVELICAANGARAESHUAYLLAY GRANDE'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANCAVELICATAYACAJAÑAHUIMPUQUIO','UNIF']='HUANCAVELICATAYACAJANAHUIMPUQUIO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOAMBOTOMAY-KICHWA','UNIF']='HUANUCOAMBOTOMAY KICHWA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOHUAMALIESPUÑOS','UNIF']='HUANUCOHUAMALIESPUNOS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOMARAÑONHUACRACHUCO','UNIF']='HUANUCOMARANONHUACRACHUCO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOMARAÑONCHOLON','UNIF']='HUANUCOMARANONCHOLON'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOMARAÑONSAN BUENAVENTURA','UNIF']='HUANUCOMARANONSAN BUENAVENTURA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOMARAÑONLA MORADA','UNIF']='HUANUCOMARANONLA MORADA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOMARAÑONSANTA ROSA DE ALTO YANAJANCA','UNIF']='HUANUCOMARANONSANTA ROSA DE ALTO YANAJANCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='HUANUCOLAURICOCHABAÑOS','UNIF']='HUANUCOLAURICOCHABANOS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='ICAICALA TINGUIÑA','UNIF']='ICAICALA TINGUINA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='JUNINHUANCAYOSAÑO','UNIF']='JUNINHUANCAYOSANO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='JUNINJAUJALEONOR ORDOÑEZ','UNIF']='JUNINJAUJALEONOR ORDONEZ'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUECHICLAYOSAÑA','UNIF']='LAMBAYEQUECHICLAYOSANA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFEFERREÑAFE','UNIF']='LAMBAYEQUEFERRENAFEFERRENAFE'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFEINCAHUASI','UNIF']='LAMBAYEQUEFERRENAFEINCAHUASI'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFECAÑARIS','UNIF']='LAMBAYEQUEFERRENAFECANARIS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFEPITIPO','UNIF']='LAMBAYEQUEFERRENAFEPITIPO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFEPUEBLO NUEVO','UNIF']='LAMBAYEQUEFERRENAFEPUEBLO NUEVO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LAMBAYEQUEFERREÑAFEMANUEL ANTONIO MESONES MURO','UNIF']='LAMBAYEQUEFERRENAFEMANUEL ANTONIO MESONES MURO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMALIMABREÑA','UNIF']='LIMALIMABRENA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETESAN VICENTE DE CAÑETE','UNIF']='LIMACANETESAN VICENTE DE CANETE'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETECALANGO','UNIF']='LIMACANETECALANGO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETECERRO AZUL','UNIF']='LIMACANETECERRO AZUL'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETECOAYLLO','UNIF']='LIMACANETECOAYLLO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETECHILCA','UNIF']='LIMACANETECHILCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEIMPERIAL','UNIF']='LIMACANETEIMPERIAL'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETELUNAHUANA','UNIF']='LIMACANETELUNAHUANA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEMALA','UNIF']='LIMACANETEMALA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETENUEVO IMPERIAL','UNIF']='LIMACANETENUEVO IMPERIAL'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEPACARAN','UNIF']='LIMACANETEPACARAN'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEQUILMANA','UNIF']='LIMACANETEQUILMANA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETESAN ANTONIO','UNIF']='LIMACANETESAN ANTONIO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETESAN LUIS','UNIF']='LIMACANETESAN LUIS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETESANTA CRUZ DE FLORES','UNIF']='LIMACANETESANTA CRUZ DE FLORES'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEZUÑIGA','UNIF']='LIMACANETEZUNIGA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMACAÑETEASIA','UNIF']='LIMACANETEASIA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMAHUAROCHIRISAN PEDRO DE LARAOS','UNIF']='LIMAHUAROCHIRILARAOS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMAYAUYOSALLAUCA','UNIF']='LIMAYAUYOSAYAUCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMAYAUYOSHUAÑEC','UNIF']='LIMAYAUYOSHUANEC'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LIMAYAUYOSVIÑAC','UNIF']='LIMAYAUYOSVINAC'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONBARRANCA','UNIF']='LORETODATEM DEL MARANONBARRANCA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONANDOAS','UNIF']='LORETODATEM DEL MARANONANDOAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONCAHUAPANAS','UNIF']='LORETODATEM DEL MARANONCAHUAPANAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONMANSERICHE','UNIF']='LORETODATEM DEL MARANONMANSERICHE'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONMORONA','UNIF']='LORETODATEM DEL MARANONMORONA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='LORETODATEM DEL MARAÑONPASTAZA','UNIF']='LORETODATEM DEL MARANONPASTAZA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='MADRE DE DIOSTAHUAMANUIÑAPARI','UNIF']='MADRE DE DIOSTAHUAMANUINAPARI'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='MOQUEGUAGENERAL SANCHEZ CERROICHUÑA','UNIF']='MOQUEGUAGENERAL SANCHEZ CERROICHUNA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PIURATALARAPARIÑAS','UNIF']='PIURATALARAPARINAS'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PIURASECHURARINCONADA-LLICUAR','UNIF']='PIURASECHURARINCONADA LLICUAR'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PUNOPUNOMAÑAZO','UNIF']='PUNOPUNOMANAZO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PUNOAZANGAROMUÑANI','UNIF']='PUNOAZANGAROMUNANI'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PUNOMELGARNUÑOA','UNIF']='PUNOMELGARNUNOA'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='PUNOEL COLLAOCAPASO','UNIF']='PUNOEL COLLAOCAPAZO'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='SAN MARTINLAMASCUÑUMBUQUI','UNIF']='SAN MARTINLAMASCUNUMBUQUI'
Wide_BASEFILT[Wide_BASEFILT$UNIF=='CALLAOCALLAOCARMEN DE LA LEGUA-REYNOSO','UNIF']='CALLAOCALLAOCARMEN DE LA LEGUA REYNOSO'



```


Preparemos los ubigeos de RENIEC/JNE
```{r}
EQUIV = import("https://github.com/Alexanderbenit7/EAP2_2023-2/raw/main/data/Equivalencias.xlsx")
```



De la base de datos de RENIEC, nos quedaremos con la variable de ubigeo y crearemos una variable que unifique las variables de región provincia y distrito y agregamos:

De la tablad e equiv quedar solo con lo de RENIEC
```{r}
RENIECEQUIV= EQUIV[,c(1,3:5) ]

```

```{r}
RENIECEQUIV$Departamento = toupper(RENIECEQUIV$Departamento)
RENIECEQUIV$Provincia=toupper(RENIECEQUIV$Provincia)
RENIECEQUIV$Distrito_reniec=toupper(RENIECEQUIV$Distrito_reniec)
```

```{r}
library(stringi)
```

```{r}
RENIECEQUIV$DEPARTAMENTO=stri_trans_general(RENIECEQUIV$Departamento, "Latin-ASCII")
RENIECEQUIV$PROVINCIA=stri_trans_general(RENIECEQUIV$Provincia, "Latin-ASCII")
RENIECEQUIV$DISTRITO=stri_trans_general(RENIECEQUIV$Distrito_reniec, "Latin-ASCII")

```


```{r}
RENIECEQUIV$UNIF = paste0(RENIECEQUIV$DEPARTAMENTO,RENIECEQUIV$PROVINCIA,RENIECEQUIV$DISTRITO)

```


```{r}
RENIECEQUIV= select(RENIECEQUIV, c(1,8))
```

```{r}
UNIFWide_BASEFILT= merge(Wide_BASEFILT, RENIECEQUIV, by = "UNIF", all.x = T)

```



REEMPLAZAMOS UBIGEO RENIEC CON INEI

```{r}
EQUIVINEI=EQUIV[,c(1:2) ]
```




Ubigeo de reniec junto
```{r}
NUEVAPLUS= merge(UNIFWide_BASEFILT, EQUIVINEI, by.x = "UBIGEO_RENIEC", by.y = "UBIGEO_RENIEC")
```




```{r}
UNONUEVAPLUS= select(NUEVAPLUS, -c(1,2))
```


Base de datos ceplan



```{r}
library(rio)
linkdataceplan="https://github.com/AndreaAmpuero13/TRABAJOGRUPAL/raw/main/CEPLAN-.xlsx"
dataCeplan=import(linkdataceplan)
```

```{r}
str(dataCeplan)
```



```{r}
#Indicadores de CEPLAN: IDH, y % de pobreza y pobreza extrema
dataCeplan= dataCeplan[,c(1,2,6,10,13,16)]
colnames(dataCeplan) = c("marca","UBIGEOi","POBTot2019", "IDH_2019","PERPOBREZAEXT","POBOCUP2017")


```

```{r}
CEPLANO = dataCeplan[-c(1:3),]

```

```{r}
str(CEPLANO$UBIGEO)
```


```{r}
CEPLANO$POBTot2019=as.numeric(CEPLANO$POBTot2019)
CEPLANO$IDH_2019=as.numeric(CEPLANO$IDH_2019)
CEPLANO$POBOCUP2017=as.numeric(CEPLANO$POBOCUP2017)
CEPLANO$PERPOBREZAEXT=as.numeric(CEPLANO$PERPOBREZAEXT)


```

```{r}
str(CEPLANO)
```


```{r}
names(UNONUEVAPLUS)
```



```{r}
MERJNECEPLAN= merge(UNONUEVAPLUS, CEPLANO, by.x = "UBIGEO_INEI", by.y = "UBIGEOi", all.x = T )
```


```{r}
colnames(MERJNECEPLAN)
```

```{r}
colnames(MERJNECEPLAN)= c("UBIGEO_INEI","Region","Provincia","Distrito","PorAusen", "APP", "FP", "PL", "RN", "marca", "POBTot2019", "IDH_2019", "PERPOBREZAEXT", "POBOCUP2017")
```


```{r}
colnames(MERJNECEPLAN)
```

```{r}
library(rio)
library(tidyverse)
library(dplyr)
```

```{r}
linkdataAnal="https://github.com/AndreaAmpuero13/TRABAJOGRUPAL/raw/main/lenguua,%20alfabetismo.xlsx"
DataLeng=import(linkdataAnal)
```

```{r}
DataLeng1=DataLeng[-c(1:4),c(2:50)]

```


```{r}
colnames(DataLeng1)
```

```{r}
colnames(DataLeng1) <- DataLeng1[1,]

```

```{r}
DataLeng2 <- DataLeng1[-1, ] 
```



```{r}
colnames(DataLeng2)
```


```{r}
DataLeng2 <- DataLeng2%>%
  select(-c("No sabe / No responde", "Sí sabe leer y escribir"))
```

```{r}
DataLeng2 <- DataLeng2 %>%
  mutate_at(vars(3:ncol(DataLeng2)), as.numeric)
```

```{r}
str(DataLeng2)
```

```{r}
lengua_fusionada <- DataLeng2 %>%
  mutate(Otras = rowSums(select(., -c(Castellano, Código, Distrito))))
```

```{r}
lengua_fusionada <- lengua_fusionada %>%
  select(Código, Castellano, Otras)
```

```{r}
str(lengua_fusionada)
```


```{r}
library(stringr)

lengua_fusionada$Código =stringr ::str_pad (lengua_fusionada$Código, 6, side= "left", pad=0)
```

```{r}

lengua_fusionada$lenguapre=ifelse(lengua_fusionada$Otras> lengua_fusionada$Castellano, "1", "0")

```

```{r}
str(lengua_fusionada$lenguapre)
```


```{r}
lengua_fusionada$lenguapre=factor(lengua_fusionada$lenguapre, levels = c(0:1), labels = c("PriorCastellano", "PriorOtras"))
```

```{r}
datafinalLeng= lengua_fusionada [,c(1,4)]
```





```{r}
TOTALMERGE= merge(MERJNECEPLAN,datafinalLeng , by.x = "UBIGEO_INEI", by.y = "Código", all.x = T)
```

```{r}

TOTALMERGE$APP[is.na(TOTALMERGE$APP)] <- 0
TOTALMERGE$FP[is.na(TOTALMERGE$FP)] <- 0
TOTALMERGE$PL[is.na(TOTALMERGE$PL)] <- 0
TOTALMERGE$RN[is.na(TOTALMERGE$RN)] <- 0

```

crear variable ganador



```{r}
TOTALMERGE = TOTALMERGE %>%
  mutate (GANADOR=case_when(APP>FP & APP> PL & APP>RN ~ "APP",
                             FP> APP & FP>PL & FP>RN ~ "FP",
                             PL> APP & PL>FP & PL>RN ~ "PL", 
                            RN>APP & RN>FP & RN>PL~ "RN",
                            (FP==PL)>APP & (FP==PL)>RN &  (FP==PL)>FP & (FP==PL)>PL ~"EMPATE FP-PL"))
```

```{r}
str(TOTALMERGE$GANADOR)
```

```{r}
TOTALMERGE$GANADOR=as.factor(TOTALMERGE$GANADOR)

```

```{r}
str(TOTALMERGE$GANADOR)
```


```{r}
levels(TOTALMERGE$GANADOR)
```




```{r}
BASEFINALIMPIA= TOTALMERGE [,c(1:9, 11:16)]
```





```{r}
BASEFINALIMPIA[BASEFINALIMPIA$UBIGEO_INEI=='120699','UBIGEO_INEI']='120604'
```


```{r}
export(BASEFINALIMPIA, "Basefinallimpiaoficial1.xlsx")
```




 

